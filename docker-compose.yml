version: '3.8'

services:
  mailserver:
    image: analogic/poste.io:latest
    container_name: poste-mailserver
    hostname: mail.example.com  # ZMIEŃ NA SWOJĄ DOMENĘ
    restart: unless-stopped
    
    # Network mode - zalecane przez Poste.io
    # Opcja 1: Host network (zalecane dla VPS)
    # network_mode: host
    
    # Opcja 2: Bridge mode z mapowaniem portów
    ports:
      - "25:25"      # SMTP - incoming mail
      - "80:80"      # HTTP - redirect to HTTPS
      - "110:110"    # POP3
      - "143:143"    # IMAP
      - "443:443"    # HTTPS - webmail + admin
      - "465:465"    # SMTPS - deprecated but still used
      - "587:587"    # SMTP Submission - preferred for sending
      - "993:993"    # IMAPS - secure IMAP
      - "995:995"    # POP3S - secure POP3
      - "4190:4190"  # ManageSieve - mail filtering
    
    environment:
      # Timezone
      - TZ=Europe/Warsaw
      
      # HTTPS configuration
      - HTTPS=ON  # Let's Encrypt auto-cert
      
      # Optional: Disable resource-intensive features
      # - DISABLE_CLAMAV=TRUE  # Oszczędzaj RAM
      # - DISABLE_RSPAMD=FALSE # Spam filtering
      
      # Optional: Custom ports
      # - HTTP_PORT=80
      # - HTTPS_PORT=443
    
    volumes:
      # Data persistence - wszystkie maile, konfiguracja, logi
      - ./data:/data
      
      # Optional: Custom SSL certificates (jeśli nie używasz Let's Encrypt)
      # - ./certs/server.crt:/data/ssl/server.crt:ro
      # - ./certs/server.key:/data/ssl/server.key:ro
      # - ./certs/ca.crt:/data/ssl/ca.crt:ro
    
    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

# Optional: Persistent volume definition
volumes:
  mail-data:
    driver: local

# Optional: Custom network
# networks:
#   mail-network:
#     driver: bridge
